function w(){const h=new WebSocket(`ws://${location.host}`);h.onopen=()=>setInterval(()=>h.send("ping"),5000),h.onmessage=(N)=>{if(N.data!=="Well received")console.log(N.data);if(N.data==="reload")location.reload()}}var T=getComputedStyle(document.documentElement);class K{h;N;static _ui=new WeakMap;_cellSize;static colorBackground=T.getPropertyValue("--neutral-white");static colorBackgroundHighlight=T.getPropertyValue("--brand-uno-background");static colorSelected=T.getPropertyValue("--brand-uno-hover");static colorText=T.getPropertyValue("--brand-uno");static colorTextLight=T.getPropertyValue("--brand-uno-light");static colorBorder=T.getPropertyValue("--sudoku-border");static colorBorderBold=T.getPropertyValue("--brand-uno");static colorSuccess=T.getPropertyValue("--signal-success");static colorSuccessBackground=T.getPropertyValue("--signal-success-background");static font=T.getPropertyValue("--font-family-primary");constructor(h,N){this._canvas=h;this._ctx=N;this._cellSize=Math.round(Math.min(h.width,h.height)/9)}static get(h){const N=h.getContext("2d");if(N===null)return!1;const B=new K(h,N);return K._ui.set(h,B),B}get width(){return this._canvas.width}get height(){return this._canvas.height}get cellSize(){return this._cellSize}clearCanvas(){return this._ctx.fillStyle=K.colorBackground,this._ctx.fillRect(0,0,this.width,this.height),this}drawCell(h,N,B=this._cellSize,W=K.colorBorder,H){const Q=h*B,Y=N*B;if(H)this._ctx.fillStyle=H,this._ctx.fillRect(Q+1,Y+1,B-2,B-2);return this._ctx.strokeStyle=W,this._ctx.strokeRect(Q,Y,B,B),this}drawRow(h,N){for(let B=0;B<9;B++)this.drawCell(B,h,this._cellSize,K.colorBorder,N);return this}drawColumn(h,N){for(let B=0;B<9;B++)this.drawCell(h,B,this._cellSize,K.colorBorder,N);return this}drawGroup(h,N,B){this.drawCell(h,N,this._cellSize*3,K.colorBorderBold,B);for(let W=0;W<3;W++)for(let H=0;H<3;H++)this.drawCell(h*3+W,N*3+H,this._cellSize,K.colorBorder);return this}drawCellValue(h,N,B){this._ctx.fillStyle=K.colorText,this._ctx.font=`600 48px ${K.font}`,this._ctx.textBaseline="middle",this._ctx.textAlign="center";const W=h*this._cellSize+Math.floor(this._cellSize*0.5),H=N*this._cellSize+Math.floor(this._cellSize*0.575);return this._ctx.fillText(B.toString(),W,H),this}drawCellDomain(h,N,B){this._ctx.fillStyle=K.colorTextLight,this._ctx.font=`400 14px ${K.font}`,this._ctx.textBaseline="top",this._ctx.textAlign="start";const W=Math.max(this._cellSize-2,Math.floor(this._cellSize*0.8)),H=Math.floor(W/3),Q=Math.max(1,Math.floor(this._cellSize*0.1)),Y=h*this._cellSize+Q,Z=N*this._cellSize+Q;for(let R=1;R<=9;R++){const X=B.has(R)?R:null,$=(R-1)%3,A=Math.floor((R-1)/3),F=Y+H*$,q=Z+H*A;this._ctx.fillText(X!==null?X.toString():"",F,q)}return this}drawEmptyGrid(){this.clearCanvas();for(let h=0;h<3;h++)for(let N=0;N<3;N++)this.drawGroup(h,N);return this}colorizeSelectedStuff(h){if(h===null)return this;const N=[Math.floor(h[0]/3),Math.floor(h[1]/3)];return this.drawRow(h[1],K.colorBackgroundHighlight).drawColumn(h[0],K.colorBackgroundHighlight).drawGroup(N[0],N[1],K.colorBackgroundHighlight).drawCell(h[0],h[1],this._cellSize,K.colorBorder,K.colorSelected),this}drawVictory(){return this._ctx.fillStyle=K.colorSuccessBackground,this._ctx.fillRect(0,0,this.width,this.height),this._ctx.fillStyle=K.colorSuccess,this._ctx.font=`600 72px ${K.font}`,this._ctx.textBaseline="middle",this._ctx.textAlign="center",this._ctx.fillText("Victory !".toUpperCase(),this._canvas.width/2,this._canvas.height/2),this}}function z(h){function N(H){H.stopPropagation();const{offsetX:Q,offsetY:Y}=H,Z=Math.min(Math.floor(Q/h.ui.cellSize),8),R=Math.min(Math.floor(Y/h.ui.cellSize),8),X=h.getSelectedCell();document.onclick=()=>{if(X===null||X[0]!==Z||X[1]!==R)h.setSelectedCell([Z,R]),h.refreshGrid()}}function B(H){if(H.stopPropagation(),h.getSelectedCell()!==null)h.setSelectedCell(null),h.refreshGrid()}function W(H){if(H.stopPropagation(),H.key>="1"&&H.key<="9"&&h.getSelectedCell()!==null){const Q=parseInt(H.key);if(Q%1===0)h.toggle(Q)}}h.canvas.addEventListener("mousemove",N),h.canvas.addEventListener("mouseout",B),document.onkeyup=W}function D(h){const{canvas:N,ui:B,cellValues:W,cellDomains:H}=h,Q=getComputedStyle(document.documentElement),Y=Q.getPropertyValue("--sudoku-border"),Z=Q.getPropertyValue("--signal-error-background");let R=1,X=1,$=Math.floor(Math.random()*9),A=Math.floor(Math.random()*9);function F(O,L){if(W[O][L]!==null)B.drawCellValue(O,L,W[O][L].value);else B.drawCellDomain(O,L,W[O][L].domain)}function q(){for(let O=0;O<9;O++)for(let L=0;L<9;L++)F(O,L)}setInterval(()=>{if(B.drawCell($,A,B.cellSize,Y,"#fff"),F($,A),$+R>8||$+R<0)R=-R;if(A+X>8||A+X<0)X=-X;$+=R,A+=X,B.drawCell($,A,B.cellSize,Y,Z),F($,A)},1000)}class _{_values;constructor(h=[]){this._values=new Set(h)}add(h){this._values.add(h)}del(h){this._values.delete(h)}has(h){return this._values.has(h)}copy(){return new _(this.toJSON())}toJSON(){const h=[];for(let N of this._values)h.push(N);return h}static validateJSON(h){if(Array.isArray(h)&&h.length>0){const N=typeof h[0];if(!h.reduce((W,H)=>W&&typeof H!==N,!0))return!1}return!0}static fromJSON(h){if(_.validateJSON(h))return new _(h);throw new Error("At least one element do not have the same type as the other")}}class f{h;_value;constructor(h){this._domain=h}get domain(){return this._domain}get value(){return this._value}set(h){if(this._domain.has(h))this._value=h}unset(){this._value=void 0}isSet(){return typeof this._value!=="undefined"}toJSON(){const h={domain:this._domain.toJSON()};if(this.isSet())h.value=this._value;return h}static fromJSON(h){if(typeof h==="object"&&("domain"in h)&&_.validateJSON(h.domain)){const B=new _(h.domain);return new f(B)}throw new Error(`Unexpected JSONVariable object: ${JSON.stringify(h)}`)}}var V=function(h){const N=document.getElementById(h),B=new _([1,2,3,4,5,6,7,8,9]),W=[];if(N===null)return console.error("Cannot get the given Canvas 2D rendering context"),!1;const Q=K.get(N);if(!Q)return!1;for(let Y=0;Y<9;Y++){W.push([]);for(let Z=0;Z<9;Z++)W[Y].push(new f(B.copy()))}return D({canvas:N,ui:Q,cellValues:W}),{canvas:N,ui:Q,cellValues:W}},y=function(h){const{canvas:N,ui:B,cellValues:W}=h;let H=null;function Q(q,O){if(W[q][O]!==null)B.drawCellValue(q,O,W[q][O].value);else B.drawCellDomain(q,O,W[q][O].domain)}function Y(){for(let q=0;q<9;q++)for(let O=0;O<9;O++)Q(q,O)}function Z(q,O,L){W[q][O].domain.del(L)}function R(q,O,L){W[q][O].domain.add(L)}function X(q,O,L,J){const P=J?Z:R,x=Math.floor(q/3),k=Math.floor(O/3);for(let M=0;M<9;M++){if(M!==q)P(M,O,L);if(M!==O)P(q,M,L)}for(let M=0;M<3;M++)for(let g=0;g<3;g++){const b=x*3+M,G=k*3+g;if(b!==q&&G!==O)P(b,G,L)}}function $(q){const O=H[0],L=H[1];if(W[O][L]===null){if(W[O][L].domain.has(q))W[O][L].set(q),X(O,L,q,!0),F()}else if(W[O][L].value===q){W[O][L].unset(),X(O,L,q,!1);for(let J=0;J<9;J++)for(let P=0;P<9;P++)if(W[J][P].value===q)X(J,P,q,!0);F()}}function A(){for(let q=0;q<9;q++)for(let O=0;O<9;O++)if(W[q][O]===null)return!1;return!0}function F(){B.drawEmptyGrid().colorizeSelectedStuff(H),Y()}if(z({canvas:N,ui:B,refreshGrid:F,toggle:$,getSelectedCell:()=>H,setSelectedCell:(q)=>H=q}),w(),F(),A())B.drawVictory()};document.addEventListener("DOMContentLoaded",(h)=>{const N=V("sudokuCanvas");if(N)y(N);console.log("Sudoku UI variables:","\n\n","- colorBackground :",K.colorBackground,"\n","- colorBackgroundHighlight :",K.colorBackgroundHighlight,"\n","- colorSelected :",K.colorSelected,"\n","- colorText :",K.colorText,"\n","- colorTextLight :",K.colorTextLight,"\n","- colorBorder :",K.colorBorder,"\n","- colorBorderBold :",K.colorBorderBold,"\n","- font :",K.font)});
